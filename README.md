# ESP32 ラジコンコントローラー

## 概要

このプロジェクトは、ESP32マイコンボードを使用したラジコンコントローラーのコードです。ESP-NOWプロトコルを使用して、ラジコン本体との間でデータを送受信します。

## ファイル構成
* `platformio.ini`: PlatformIOプロジェクトの設定ファイル
* `src/`
    * `main.cpp`: メインのプログラムファイル。ESP-NOWの初期化、データの送受信などを実行します。
    * `ESPNowManager.cpp`: ESP-NOW通信の初期化、ペアリング処理を管理するクラスの実装
    * `ESPNowManager.h`: ESPNowManagerクラスのヘッダーファイル

## 各ファイルの説明

* `platformio.ini`: PlatformIOのプロジェクト設定ファイルです。使用するプラットフォームやライブラリなどの情報が記述されています。
* `src/ESPNowManager.cpp`、`src/ESPNowManager.h`: ESP-NOWの初期化、デバイスとのペアリングなどのESP-NOW通信を管理するクラスの実装と定義です。
* `src/main.cpp`: メインのプログラムファイルです。
    * ピンの初期化
    * ESP-NOWの初期化
    * データの送受信
    * 各種スイッチ、スライドボリュームの読み取り
    * LED制御
    * バッテリー電圧の監視

## 開発環境

* ESP32マイコンボード
* PlatformIO
* Arduinoフレームワーク

## 使い方

1.  **必要なライブラリのインストール:**
    * PlatformIOがインストールされていることを確認してください。
    * 必要なライブラリは、`platformio.ini`ファイルに記述されています。PlatformIOは、これらのライブラリを自動的にインストールします。
2.  **MACアドレスの設定:**
    * `src/Secret.cpp`に、通信相手となるラジコン本体のESP32のMACアドレスを記述します。
3.  **ビルドと書き込み:**
    * PlatformIOを使用して、コードをビルドし、ESP32マイコンボードに書き込みます。
4.  **動作確認:**
    * ESP32コントローラーの電源を入れ、ラジコン本体との通信が確立されることを確認します。
    * 各種スイッチ、スライドボリュームの操作が、ラジコン本体に反映されることを確認します。

## コードの概要

### ESPNowManagerクラス

ESP-NOWの初期化、デバイスとのペアリングを管理します。

* `bool init()`: ESP-NOWを初期化します。
* `bool pairDevice(const uint8_t *mac_addr, int channel = 0, bool autoChannel = true)`: 指定されたMACアドレスを持つデバイスとペアリングします。

### メインプログラム

* **ピンの初期化:**
    * 各種スイッチ、スライドボリューム、LED、バッテリー電圧測定用のピンを設定します。
* **ESP-NOWの初期化:**
    * `ESPNowManager`クラスを使用してESP-NOWを初期化し、送信・受信のコールバック関数を登録します。
* **データの送受信:**
    * 送信するデータは、`SaneDataPacket`構造体で定義されています。
    * 受信するデータは、`ReceivedDataPacket`構造体で定義されています。
    * `esp_now_send()`関数でデータを送信し、`esp_now_recv_cb`で受信したデータを処理します。
* **各種スイッチ、スライドボリュームの読み取り:**
    * `digitalRead()`関数でスイッチの状態を読み取ります。
    * `analogRead()`関数でスライドボリュームの値を読み取ります。
* **LED制御:**
    * `ledcWrite()`関数でLEDの明るさを制御します。
* **バッテリー電圧の監視:**
    * `analogRead()`関数でバッテリー電圧を測定し、電圧が低下した場合はLEDを点滅させて警告します。

## ライセンス

本ソフトウェアは、非商用かつ個人利用の目的でのみ使用が許諾されます。

商用利用、改変、複製、再配布、逆コンパイル、リバースエンジニアリング、逆アセンブル、その他、著作権者の権利を侵害する行為は禁止されています。

## 免責事項

著作権者は、本ソフトウェアの利用に関して、いかなる保証も行わないものとします。

本ソフトウェアの利用によって生じた損害について、著作権者は一切の責任を負わないものとします。

## 著作権

本ソフトウェアの著作権は、著作権者に帰属します。

## 著者

\[Kazushi Takenaka\]